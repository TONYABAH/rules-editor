!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).myLibrary={})}(this,(function(e){"use strict";class s{constructor(e){this.message=e,this.name="Error",this.code=0}}class r extends s{constructor(e,t){super(e),this.code=t,this.name="ValidationError"}}class n extends s{constructor(e,t){super(e),this.code=t,this.name="SecurityError"}}class i extends Error{constructor(e,t){super(e),this.name="ScriptError",this.code="SystemError",this.data=t}}var o={ValidationError:r,SecurityError:n,DatabaseError:class extends s{constructor(e,t){super(e),this.code=t,this.name="DatabaseError"}},NetworkError:class extends s{constructor(e,t){super(e),this.name="NetworkError",this.code=t}},ScriptError:i,SyntaxError:class extends s{constructor(e,t){super(e),this.name="SyntaxError",this.code=t}}};const a={ScriptError:"ScriptError",NetworkError:"NetworkError",TokenRequired:"TokenRequired",TokenExpired:"TokenExpired",TokenInvalid:"TokenInvalid",APIKeyNotFound:"APIKeyNotFound",APIKeyInvalid:"APIKeyInvalid",CredentialsInvalid:"CredentialsInvalid",UserNotFound:"UserNotFound",AccessDenied:"AccessDenied",InvalidSelection:"InvalidSelection",NoSelection:"NoSelection",SelectionsAboveRange:"SelectionsAboveRange",SelectionsBelowRange:"SelectionsBelowRange",CharactersAboveRange:"CharactersAboveRange",CharactersBelowRange:"CharactersBelowRange",NumberAboveRange:"NumberAboveRange",NumberBelowRange:"NumberBelowRange",NumberRequired:"NumberRequired",NoActiveSession:"NoActiveSession",NoInput:"NoInput",PromptNotFound:"PromptNotFound",KnowledgebaseNotFound:"KnowledgebaseNotFound",SessionExpired:"SessionExpired",UnknownToken:"UnknownToken",NoCloseParenthesis:"NoCloseParenthesis",NoOpenParenthesis:"NoOpenParenthesis",DuplicateOperator:"DuplicateOperator",NoDefinition:"NoDefinition",NoAttributeName:"NoAttributeName",ExpectedEQ:"ExpectedEQ",ExpectNoEOF:"ExpectNoEOF",ExpectNoNewLine:"ExpectNoNewLine",ExpectedArrayname:"ExpectedArrayname",ExpectedOpenParenthesis:"ExpectedOpenParenthesis",ExpectedNumberOrAttrib:"ExpectedNumberOrAttrib",ExpectedComma:"ExpectedComma",ExpectedCloseParenthesis:"ExpectedCloseParenthesis",NoGoalName:"NoGoalName",NoPromptText:"NoPromptText",ExpectType:"ExpectType",ExpectComparator:"ExpectComparator",NoInputForAttrib:"NoInputForAttrib"};var l={ScriptError:"Scripting Engine Error has occured",NetworkError:"The response was not ok",TokenRequired:"Auth token not found",TokenExpired:"Auth token has expired",TokenInvalid:"Auth token is invalid",APIKeyNotFound:"API key not found",APIKeyInvalid:"API key invalid",CredentialsInvalid:"Supplied credentials invalid",UserNotFound:"User not in database",AccessDenied:"Access denied",InvalidSelection:"Selected menu item does not exist",NoSelection:"No selection was made",SelectionsAboveRange:"Selections above range",SelectionsBelowRange:"Selections below range",CharactersAboveRange:"Characters above range",CharactersBelowRange:"Characters below range",NumberAboveRange:"Number input is above range",NumberBelowRange:"Number input is below range",NumberRequired:"Number input is required",NoActiveSession:"No active session",NoInput:"No input received",PromptNotFound:"No such prompt",KnowledgebaseNotFound:"Knowledge base was not found",SessionExpired:"Session has expired",ValidationError:"Validation error",UnknownToken:"Unknown character or token: {0}",NoCloseParenthesis:"Open Parenthesis '{0}' at column {1} has no close Parenthesis",NoOpenParenthesis:"Close Parenthesis '{0}' at column {1} has no opening Parenthesis",DuplicateOperator:"Duplicate operator '{0}' '{1}'",NoDefinition:"{0} definition should have texts",NoAttributeName:"Attribute definition should have Attribute Name",ExpectedEQ:"Expected '='",ExpectNoEOF:"Expected expression but found end of file",ExpectNoNewLine:"Expected expression but found new line",ExpectedArrayname:"Expected array name",ExpectedOpenParenthesis:"Expected '('",ExpectedNumberOrAttrib:"Expected number or Attribute",ExpectedComma:"Expected ','",ExpectedCloseParenthesis:"Expected ) but found new line",NoGoalName:"Goal definition should have texts",NoPromptText:"Prompt definition should have texts",ExpectType:"Expected '{0}' but found '{1}'",ExpectComparator:"Expected comparator but found '{0}' '{1}'",NoInputForAttrib:"No input prompt for attribute '{0}'"},h={ScriptError:"Une erreur du moteur de script s'est produite",NetworkError:"La réponse n'était pas correcte",TokenRequired:"Jeton d'authentification introuvable",TokenExpired:"Le jeton d'authentification a expiré",TokenInvalid:"Le jeton d'authentification n'est pas valide",APIKeyNotFound:"Clé API introuvable",APIKeyInvalid:"Clé API invalide",CredentialsInvalid:"Informations d'identification fournies non valides",UserNotFound:"Utilisateur absent de la base de données",AccessDenied:"Accès refusé",InvalidSelection:"L'élément de menu sélectionné n'existe pas",NoSelection:"Aucune sélection n'a été effectuée",SelectionsAboveRange:"Sélections au-dessus de la plage",SelectionsBelowRange:"Sélections inférieures à la plage",CharactersAboveRange:"Caractères au-dessus de la plage",CharactersBelowRange:"Caractères en dessous de la plage",NumberAboveRange:"L'entrée numérique est au-dessus de la plage",NumberBelowRange:"L'entrée numérique est inférieure à la plage",NumberRequired:"Une saisie numérique est requise",NoActiveSession:"Aucune session active",NoInput:"Aucune entrée reçue",PromptNotFound:"Aucune invite de ce type",KnowledgebaseNotFound:"La base de connaissances est introuvable",SessionExpired:"La session a expiré"};class c{constructor(e,t="en"){this.target=e,this.source=t,this.data=null,this.locales={en:l,fr:h}}get(e){const t=this.locales[this.target];return Object.keys(t).find((t=>t===e))?t[k]:null}format(...e){let t=Object.assign({},this.data),s=0;return e.forEach((e=>{t=t.replace(`{${s}}`,e),s++})),t}translate(e){return this.data=this.get(e),this}translatePlain(e){if(this.to===this.from)return this.data=e,this;const t=Object.values(this.source).find((t=>t===e)),s=Object.keys(this.source)[t];return this.translate(s)}t(e){return this.translate(e)}tp(e){return this.translatePlain(e)}}class u extends c{constructor(e="en"){super(e),this.language=e}raiseValidationError(e){const t=this.t(e).data;return new r(t,e)}validateCF(e,t){const s=e;return isNaN(s)||0==s||s<1||s>t.Menu.length?this.raiseValidationError(a.InvalidSelection):void 0}validateMenu(e,t){return 0===e.length?this.raiseValidationError(a.NoSelection):e.length<t.Min?this.raiseValidationError(a.SelectionsBelowRange):e.length>t.Max?this.raiseValidationError(a.SelectionsAboveRange):void e.forEach((e=>isNaN(e)||0==e||e<0||e>t.Menu.length?this.raiseValidationError(a.InvalidSelection):void 0))}validateText(e,t){return e.length<t.Min?this.raiseValidationError(a.CharactersBelowRange):e.length>t.Max?this.raiseValidationError(a.CharactersAboveRange):void 0}validateNumeric(e,t){const s=Number(e);return isNaN(s)?this.raiseValidationError(a.NumberRequired):t.Max||t.Min?s<t.Min?this.raiseValidationError(a.NumberBelowRange):s>t.Max?this.raiseValidationError(a.NumberAboveRange):void 0:null}validate(e,t){if(!t.Type)return this.raiseValidationError(a.NoActiveSession);if(!e||0===e.toString().trim().length)return this.raiseValidationError(a.NoInput);if("CF"===t.Label.toUpperCase())return this.validateCF(e,t);switch(t.Type.toUpperCase()){case"MENU":case"YN":case"TF":{const s=e.toString().split(",");return this.validateMenu(s,t)}case"NUMBER":return this.validateNumeric(e,t);default:return this.validateText(e,t)}}}const p="REM",d="COMMENT",g="ARRAY",m="ATTR",b="LINE",f="TF",w="YN",v="RULE",y="ELSE",x="ELSEIF",E="THEN",N="AND",M="OR",C="IF",T="PROMPT",A="QUESTION",L="YES",I="NO",P="TRUE",S="FALSE",R="TEXT",F="MENU",O="NUM",j="EXCLUDE",D="INCLUDE",U="NOT",V="IS",B="LPAREN",z="RPAREN",Y="LBRACKET",G="RBRACKET",_="CARRET",H="TIMES",K="DIV",Q="PLUS",X="MINUS",q="STRING",W="MOD",$="EQ",Z="GT",J="LT",ee="COMMA",te="SPACE",se="ERROR",re="EOF",ne="FUNC",ie="CONST";var oe={en:{CODE:"en",NAME:"English",QUES:"How sure about your answer?",CF_TEXTS:["Absolutely sure","Very sure","Sure","Not so sure","Not sure"],VALUES:[99,95,80,75,60],ALPHA:["A","B","C","D","E"]},fr:{CODE:"fr",NAME:"Français",QUES:"Quelle est votre réponse?",CF_TEXTS:["Absolument sûr","Très sûr","Bien sûr","Pas si sûr","Pas sûr"],VALUES:[99,95,80,75,60],ALPHA:["A","B","C","D","E"]}};var ae={en:{LANGUAGE:"language",TITLE:"title",SUMMARY:"summary",ATTRIBUTE:"attribute",ARRAY:"array",OBJECT:"object",GOAL:"goal",REM:"rem",COMMENT:"comment",RULE:"rule",IF:"if",AND:"and",OR:"or",THEN:"then",ELSEIF:"else if",ELSE:"else",PROMPT:"prompt",QUESTION:"question",MENU:"menu",DIGIT:"DIGIT",TEXT:"text",CF:"%",LOAD:"load",IS:"is",IN:"in",INCLUDE:"include",EXCLUDE:"exclude",TRUE:"true",FALSE:"false",MIN:"min",MAX:"max"},fr:{LANGUAGE:"langue",TITLE:"titre",SUMMARY:"résumé",ATTRIBUTE:"attribut",ARRAY:"tableau",OOBJECT:"objet",GOAL:"objetif",REM:"rem",COMMENT:"commentaire",RULE:"règle",IF:"si",AND:"et",OR:"ou",THEN:"puis",ELSEIF:"elseif",ELSE:"autre",PROMPT:"contribution",QUESTION:"question",MENU:"menu",DIGIT:"digit",TEXT:"texte",CF:"%",LOAD:"charge",IS:"est",IN:"dans",INCLUDE:"comprendre",EXCLUDE:"exclure",TRUE:"vrai",FALSE:"faux",MIN:"min",MAX:"max"}};class le{constructor(e,t,s,r){this.type=e,this.value=t,this.row=s||0,this.column=r||0,this.length=t?t.length:0}}class he{}class ce extends he{constructor(e,t,s){super(),this.left=e,this.token=this.op=t,this.right=s}}class ue extends he{constructor(e){super(),this.token=e,this.value=e.value}}class pe extends he{constructor(e){super(),this.token=e,this.value=e.value}}class de extends he{constructor(e){super(),this.token=e,this.value=e.value}}class ge extends he{constructor(e){super(),this.token=e,this.value=e.value}}class me extends he{constructor(e,t){super(),this.token=this.op=e,this.params=[t]}}class be extends he{constructor(e){super(),this.token=e,this.value=e.value}}class fe{constructor(e,t){this.token=this.op=e,this.expr=t}}class we{constructor(){this.tokens=[],this.pos=0,this.current_token=null}matchCloseParenthesis(e,t){let s=-1,r=0,n=0;for(let i=t;i<e.length;i++){const t=e[i].value;if("("===t?r++:")"===t&&n++,r>0&&r===n){s=i;break}}return s}matchOpenParenthesis(e,t){let s=-1,r=0,n=0;for(let i=t;i>=0;i--){const t=e[i].value;if("("===t?r++:")"===t&&n++,r>0&&r===n){s=i;break}}return s}matchParenthesis(e){if(!e)return;this.matchBrackets(e);const t=[],s=[];for(let r=0;r<e.length;r++){const n=e[r].value;"("===n?t.push([r,n]):")"===n&&s.push([r,n])}for(let s=t.length-1;s>=0;s--){if(-1===this.matchCloseParenthesis(e,t[s][0])){const e="Open parenthesis '{0}' at column {1} has no close parenthesis";this.error(e);break}}for(let t=0;t<s.length;t++){const r=s[t][0];if(-1===this.matchOpenParenthesis(e,r)){const e="Close parenthesis '{0}' at column {1} has no opening parenthesis";this.error(e);break}}}error(){return new Error("Invalid syntax")}getNextToken(){for(this.pos++;this.tokens[this.pos];)return this.current_token=this.tokens[this.pos],this.current_token;return{type:"EOF",value:null}}eat(e){this.current_token.type===e?this.current_token=this.getNextToken():this.error()}factor(){const e=this.current_token;if(e.type===Q){this.eat(Q);return new fe(e,this.factor())}if(e.type===X){this.eat(X);return new fe(e,this.factor())}if(e.type===ie)return this.eat(ie),new ge(e);if(e.type===ne){this.eat(ne);return this.parseFunc(e)}if(e.type===O)return this.eat(O),new ue(e);if(e.type===m)return this.eat(m),"object"==typeof e.value?this.parseExpr(e):new de(e);if(e.type===q)return this.eat(q),new pe(e);if(e.type===P)return this.eat(P),new de(e);if(e.type===S)return this.eat(S),new de(e);if(e.type===L)return this.eat(L),new de(e);if(e.type===I)return this.eat(I),new de(e);if(e.type===ee)return this.eat(ee),new be(e);if(e.type===B){this.eat(B);const e=this.expr();return this.eat(z),e}if(e.type===Y){this.eat(Y);const e=this.expr();return this.eat(G),e}return null}parseExpr(e){let t=[],s=!1;if(e.value.forEach((e=>{"ATTR"===e.type&&(s=!0),t.push(e.value)})),s){return e.value=t.join(" "),new de(e)}return new fe(e,this.build(e.value))}parseFunc(e){let t=this.matchCloseParenthesis(this.tokens,this.pos-1);this.eat(B);const s=new me(e,this.expr());for(;this.pos<t;){if(this.current_token.type!==ee){let e=this.expr();e&&s.params.push(e)}this.getNextToken()}return this.eat(z),s}term(){let e=this.factor();for(;this.current_token.type===H||this.current_token.type===K||this.current_token.type===W;){const t=this.current_token;t.type===H?this.eat(H):t.type===K?this.eat(K):t.type===W&&this.eat(W),e=new ce(e,t,this.factor())}return e}expr(){let e=this.term();for(;this.current_token.type===Q||this.current_token.type===X;){const t=this.current_token;t.type==Q?this.eat(Q):t.type==X&&this.eat(X),e=new ce(e,t,this.term())}return e}build(e){this.tokens=e,this.pos=0,this.current_token=this.tokens[this.pos];return this.expr()}}class ve{constructor(){}visit(e){return e instanceof ce?this.visit_BinOp(e):e instanceof fe||e instanceof me?this.visit_UnaryOp(e):e instanceof ge?this.visit_Const(e):e?this.visit_Attr(e):null}visit_BinOp(e){return e.op.type==Q?Number(this.visit(e.left))+Number(this.visit(e.right)):e.op.type==X?this.visit(e.left)-this.visit(e.right):e.op.type==H?this.visit(e.left)*this.visit(e.right):e.op.type==K?this.visit(e.left)/this.visit(e.right):e.op.type==W?this.visit(e.left)%this.visit(e.right):e.value}visit_UnaryOp(e){const t=e.op.type;if(t==Q)return+this.visit(e.expr);if(t==X)return-this.visit(e.expr);if("ATTR"==t)return this.visit(e.expr);if("FUNC"===t){let t=[];return e.params.map((e=>{e&&t.push(this.visit(e))})),t?Math[e.op.value](...t):Math[e.op.value]()}return null}visit_Num(e){return e.value}visit_Str(e){return e.value}visit_Attr(e){return e.value}visit_Const(e){return Math[e.value]}interpret(e){this.ast=e;return this.visit(this.ast)}}var ye="MENU",ke="NUMBER",xe="TEXT",Ee="VALUE",Ne="YN",Me="TF";class Ce{constructor(e){this.Line=null,this.Index=0,this.Label="Prompt",this.Fired=!1,this.Name=e,this.Question=null,this.CFMode=!1,this.Type=ke,this.Menu=[],this.Min=null,this.Max=null}}function Te(e){switch(e.Type){case ye:e.Max||(e.Max=e.Menu.length),e.Min||(e.Min=1),e.Min=e.Min<1?1:e.Min,e.Max=e.Max>e.Menu.length?e.Menu.length:e.Max,e.Max||(e.Max=1);break;case xe:case Ee:e.Max||(e.Max=256),e.Min||(e.Min=1),e.Min=e.Min<1?1:e.Min,e.Max=e.Max>256?256:e.Max;break;case Me:case Ne:e.Min=1,e.Max=1;break;default:e.Max||(e.Max=Number.MAX_VALUE),e.Min||(e.Min=Number.MIN_VALUE),e.Min=e.Min<Number.MIN_VALUE?Number.MIN_VALUE:e.Min,e.Max=e.Max>Number.MAX_VALUE?Number.MAX_VALUE:e.Max}}const Ae=new c;function Le(e){const t=Ae.translate(e).data;return new r(t,e)}function Ie(e,t,s="en"){if(Ae.target=s,!e||0===e.length)return Le(a.NoInput);if(!t)return Le(a.NoActiveSession);if("NUMBER"===t.Type||"TEXT"===t.Type||"VALUE"===t.Type)return e&&e instanceof Array?e[0]:e;const r=e.toString().trim().split(/,/g),n=[];for(let e=0;e<r.length;e++){const s=r[e];if(!t.Menu[s-1])return Le(a.InvalidSelection);n.push(t.Menu[s-1].Value)}return n.length>0?n:null}class Pe extends c{constructor(e){if(super(),!e)throw new ReferenceError("kb is undefined");this.paused=!1,this.CFSettings=null,this.keywords=null,this.done=!1,this.knowledgebase=e,this.CFSettings=oe[e.language.toLowerCase()],this.keywords=ae[e.language.toLowerCase()],this.validator=new u(e.language),this.target=e.language}raiseScriptError(e){const t=this.translate(a.ScriptError).data;throw new i(t,a.ScriptError,e)}raisePromptNotFoundError(){const e=this.t(a.PromptNotFound).data;return new r(e,a.PromptNotFound)}raiseSessionExpiredError(){const e=this.t(a.SessionExpired).data;return new r(e,a.SessionExpired)}getEventData(e,t){return{status:"error",msg:t,code:e,text:this.lineText,line:this.lineNumber,rule:this.knowledgebase.currentRule.Name,ruleNumber:this.knowledgebase.ruleIndex+1}}calculateCF(e,t,s){let r=0;switch(s){case"+":r=e/100*(100-t);break;case"x":r=e*t/100;break;case"AVE":r=(e+t)/2;break;case"MAX":r=Math.max(e,t);break;case"MIN":r=Math.min(e,t);break;default:r=e/100*(100-t)}return r}start(){if(this.paused=!1,this._error=null,this.done=!1,this.command=null,!this.knowledgebase)return this.raiseSessionExpiredError();for(;this.knowledgebase.ruleIndex<this.knowledgebase.rules.length;){if(this.knowledgebase.currentRule=this.knowledgebase.rules[this.knowledgebase.ruleIndex],this.knowledgebase.ruleIndex++,this.knowledgebase.currentRule.Fired)continue;this.knowledgebase.currentPrompt=null;let e=0;for(;e<this.knowledgebase.currentRule.Conditions.length;){this.knowledgebase.currentCondition=this.knowledgebase.currentRule.Conditions[e],e++;const t=this.testPremises();if(!0===Boolean(t)){const e=this.fireRule(this.knowledgebase.currentCondition.Inferences);if(e)return e}else{if(this.paused)return this.knowledgebase.ruleIndex--,this.knowledgebase.currentPrompt;if(this.knowledgebase.currentRule.Conditions.length<=e){const e=this.fireRule(this.knowledgebase.currentRule.AltInferences);if(e)return e}}if(this.done)break}if(this.done)break}return this.knowledgebase.ruleIndex=0,this.knowledgebase.answers}testPremises(){const e=this.knowledgebase.currentCondition.Premises.length-1;let t=null;for(let s=0;s<=e;s++){const e=this.knowledgebase.currentCondition.Premises[s];if(!0===t&&e.Keyword===this.keywords.OR.toUpperCase())continue;if(!1===t&&e.Keyword.toUpperCase()===this.keywords.AND.toUpperCase())continue;const r=this.mapNodes(e.Left);if(this.paused)return!1;const n=this.mapNodes(e.Right);if(this.paused)return!1;const i=this.solve(r)||"",o=!(e.Right.length>0)||this.solve(n),a=Math.min(this.evaluateCF(e.Left)),l=Math.min(this.evaluateCF(e.Right)),h=Math.min(a,l);if(h<100){const t=e.Keyword===this.keywords.OR.toUpperCase()?"x":"AVE";let s=this.knowledgebase.CF||100;this.knowledgebase.CF=this.calculateCF(s,h,t)}t=this.compare(i,o,e.Comparator)}return t}solveAttribute(e,t){const s=this.mapNodes(e),r=this.solve(s),n=this.knowledgebase.attributes[t.Name.toLowerCase()];let i=n.CF;return this.setAttributeValueAndCF(n.Name.toLowerCase(),r,i),this.setAttributeValueAndCF(n.Name.toLowerCase(),r,this.knowledgebase.prevCf),n.Value=r,t.Value=r,!!(this.knowledgebase.goals[n.Name.toLowerCase()]&&(this.knowledgebase.answers.push({Name:n.Name,Value:r,CF:Math.round(this.knowledgebase.CF)}),this.knowledgebase.answers.length>=Object.getOwnPropertyNames(this.knowledgebase.goals).length))&&(this.fireDoneEvent(),this.done=!0,this.knowledgebase.answers)}fireRule(e){if(this.knowledgebase.currentCondition.isMet=!0,this.knowledgebase.firedRules[this.knowledgebase.currentRule.Name]=this.knowledgebase.currentRule,this.knowledgebase.currentRule.Fired)return!1;if(this.knowledgebase.currentRule.Fired=!0,!e)return!1;for(let t=0;t<e.length;t++){const s=e[t],r=s.Value;if(/^fetch\s[a-zA-Z]+/i.test(s.Name))return this.command={type:"command",cmd:"fetch",url:s.Name.split(" ")[1]},this.command;const n=this.solveAttribute(r,s);if(n)return n}return!1}fireDoneEvent(){}solve(e){const t=new we,s=new ve,r=t.build(e);return s.interpret(r)}compare(e,t,s){switch(s){case"GT":return e>t;case"LT":return e<t;case"IN":return Pe.inArray(e,t);case"EX":return Pe.notInArray(e,t);default:return e.toString().toLowerCase()===t.toString().toLowerCase()}}mapNodes(e){const t=[];for(let s=0;s<e.length;s++){const r=e[s];let n=r.value;if("ATTR"===r.type){const e=this.knowledgebase.attributes[r.value.toLowerCase()];if(e){if(null===e.Value&&this.knowledgebase.prompts[r.value.toLowerCase()])return this.prompt(r.value),this.paused=!0,null;null===e.Value&&(e.Value=e.Name),n=e.Value}}t.push({type:r.type,value:n})}return t}evaluateCF(e){return e.map((e=>{let t=100;if("ATTR"===e.type){const s=this.knowledgebase.attributes[e.value.toLowerCase()];s&&s.CF&&(t=s.CF)}return t}))}prompt(e){const t=e.toLowerCase().trim();return this.knowledgebase.prompts[t]?(this.knowledgebase.prompts[t].Fired=!0,Te(this.knowledgebase.prompts[t]),this.knowledgebase.currentPrompt=this.knowledgebase.prompts[t],this.knowledgebase.currentPrompt.Index=this.knowledgebase.promptIndex,this.knowledgebase.promptIndex++,this.knowledgebase.currentPrompt):this.raisePromptNotFoundError()}cfPrompt(){const e=this.CFSettings.CF_TEXTS,t=this.CFSettings.VALUES;this.knowledgebase.currentPrompt.Label="CF",this.knowledgebase.currentPrompt.Question=this.CFSettings.QUES,this.knowledgebase.currentPrompt.Type=F,this.knowledgebase.currentPrompt.Min=1,this.knowledgebase.currentPrompt.Max=1,this.knowledgebase.currentPrompt.CFMode=!1,this.knowledgebase.currentPrompt.Menu=[];for(let s=0;s<e.length;s++){const r={Index:s+1,Name:e[s],Value:t[s]};this.knowledgebase.currentPrompt.Menu.push(r)}return Te(this.knowledgebase.currentPrompt),this.knowledgebase.currentPrompt.Index=this.knowledgebase.promptIndex,this.knowledgebase.currentPrompt.Fired=!0,this.knowledgebase.promptIndex++,this.knowledgebase.currentPrompt}setAttribute(e){if(!this.knowledgebase.currentPrompt)return this.raiseSessionExpiredError();const t=this.validator.validate(e,this.knowledgebase.currentPrompt);if(t instanceof r)return t;let s=Ie(e,this.knowledgebase.currentPrompt,this.knowledgebase.language);return s instanceof r?s:(s&&(s=s instanceof Array?s.join(";"):s),"CF"===this.knowledgebase.currentPrompt.Label?(this.setAttributeCF(this.knowledgebase.currentPrompt.Name,s),this.knowledgebase.currentCondition.Confidences.push(s),this.start()):(this.knowledgebase.attributes[this.knowledgebase.currentPrompt.Name.toLowerCase()].Value=s,this.knowledgebase.currentPrompt.CFMode?this.cfPrompt():(this.knowledgebase.currentPrompt=null,this.start())))}setAttributeCF(e,t){this.knowledgebase.attributes[e.toLowerCase().trim()].CF=t,this.knowledgebase.currentPrompt=null}setAttributeValueAndCF(e,t,s){this.knowledgebase.attributes[e.toLowerCase().trim()]&&(this.knowledgebase.attributes[e.toLowerCase().trim()].Value=t,s>-1&&s<100?this.setAttributeCF(e,s):this.knowledgebase.currentPrompt=null)}static inArray(e,t){return e.includes(t.toLowerCase().trim())}static notInArray(e,t){return!e.includes(t.toLowerCase().trim())}getConditionCF(){let e=100;return this.knowledgebase.currentCondition.Confidences.forEach((function(t){e*=t/100})),e}run(){try{return this.start()}catch(e){return this.raiseScriptError(e)}}input(e){try{return this.setAttribute(e)}catch(e){return this.raiseScriptError(e)}}getKnowledgebase(){return this.knowledgebase}setKnowledgebase(e){this.knowledgebase=e,this.CFSettings=oe[this.knowledgebase.language.toLowerCase()],this.keywords=ae[this.knowledgebase.language.toLowerCase()]}}class Se{constructor(e){this.Name=e,this.Line=0,this.CF=100,this.Value=null}}class Re extends Se{constructor(e){super(e),this.Action=null}}class Fe extends Se{constructor(e){super(e)}}class Oe{constructor(){this.Inferences=[],this.Confidences=[],this.Premises=[],this.isMet=!1}static getCF(e){let t=100;return e.confidences.forEach((e=>{t*=e/100})),t}}class je{constructor(e){this.line=e||0,this.Index=0,this.Keyword=null,this.Left=null,this.Right=null,this.Comparator=null}}const De=["@","A","B","C","D","E","F","G","H","I","J"];class Ue{constructor(e,t,s){this.Index=e,this.Name=t,this.Value=s,this.Letter=De[e],this.Line=0}}class Ve{constructor(e){this.Name=e,this.Fired=!1,this.Texts=[],this.Line=0,this.Index=0,this.AltInferences=[],this.Conditions=[]}addLine(e){this.Texts.push(e)}}class Be{constructor(e){this.language=e.language||"en",this.keywords=ae[this.language],this.parser=e,this.title="",this.summary="",this.delimiter=" ",this.activePrompt=null,this.arrays={},this.objects={},this.goals={},this.prompts={},this.attributes={},this.firedRules={},this.answers=[],this.rules=[],this.subscriptions=[],this.attachListeners()}subscribe(e,t){let s=this.parser.on(e,t);this.subscriptions.push(s)}unsubscribe(){this.subscriptions.forEach((e=>e.remove()))}attachListeners(){this.subscribe("rule",(e=>this.addRule(e[0],e[1]))),this.subscribe("inference",(e=>{let[t,s,r,n]=e;this.addInference(t.value,s,r,n)})),this.subscribe("premise",(e=>{let[t,s,r,n,i]=e;return this.addPremise(t,s,r,i,n)})),this.subscribe("condition",(e=>{let[t,s,r,n,i]=e;return this.addCondition(t,s,r,i,n)})),this.subscribe("prompt",(e=>this.addPrompt(e[0],e[1]))),this.subscribe("question",(e=>this.addQuestion(e[0],e[1]))),this.subscribe("menu",(e=>this.addMenu(e[0],e[1]))),this.subscribe("digit",(e=>this.addNumber(e[0]))),this.subscribe("text",(e=>this.addText(e[0]))),this.subscribe("yes-no",(e=>this.addYesNo(e[0]))),this.subscribe("true-false",(e=>this.addTrueFalse(e[0]))),this.subscribe("min",(e=>this.setMin(e[0],e[1]))),this.subscribe("max",(e=>this.setMax(e[0],e[1]))),this.subscribe("cf",(()=>this.setPromptCFMode())),this.subscribe("attribute",(e=>this.setAttribute(e[0][0],e[0][1],e[1]))),this.subscribe("goal",(e=>this.addGoal(e[0],e[1]))),this.subscribe("title",(e=>this.setTitle(e[0],e[1]))),this.subscribe("summary",(e=>this.setSummary(e[0],e[1]))),this.subscribe("line",(()=>this.addNewLine())),this.subscribe("done",(()=>this.unsubscribe()))}get Data(){return{language:this.language,keywords:this.keywords,line:0,promptIndex:1,ruleIndex:0,title:this.title,summary:this.summary,delimiter:this.delimiter,arrays:this.arrays,objects:this.objects,goals:this.goals,prompts:this.prompts,attributes:this.attributes,firedRules:this.firedRules,answers:this.answers,rules:this.rules}}get Keywords(){return this.keywords}get Rules(){return this.rules}get ActiveRule(){return this.rules[this.rules.length-1]}get ActiveCondition(){let e=this.ActiveRule;return e.Conditions[e.Conditions.length-1]}get ActivePrompt(){return this.activePrompt}set ActivePrompt(e){this.activePrompt=e}setTitle(e){this.title=e}setSummary(e){this.summary=e}setMin(e){this.ActivePrompt.Type!==w&&this.ActivePrompt.Type!==f||(e=1),this.prompts[this.ActivePrompt.Name].Min=this.ActivePrompt.Min=e.value||e}setMax(e){this.ActivePrompt.Type!==w&&this.ActivePrompt.Type!==f||(e=1),this.prompts[this.ActivePrompt.Name].Max=this.ActivePrompt.Max=e.value||e}setPromptType(e){this.ActivePrompt.Type=e}addText(){this.setPromptType(R)}addNumber(){this.setPromptType("NUMBER")}addMenu(e){this.ActivePrompt.Menu=[];let t=1;e.forEach((e=>{const s=new Ue(t,e,e);this.ActivePrompt.Menu.push(s),t++})),this.setPromptType(F)}addTrueFalse(){this.ActivePrompt.Menu=[];let e=1;[!0,!1].forEach((t=>{const s=new Ue(e,t,t);this.ActivePrompt.Menu.push(s),e++})),this.ActivePrompt.Type=f,this.setMin(1),this.setMax(1)}addYesNo(){this.ActivePrompt.Menu=[];let e=1;[!0,!1].forEach((t=>{const s=new Ue(e,t,t);this.ActivePrompt.Menu.push(s),e++})),this.ActivePrompt.Type=w,this.setMin(1),this.setMax(1)}addQuestion(e){this.ActivePrompt.Question=e}addPrompt(e,t){const s=new Ce(e.toLowerCase());s.Line=t,this.prompts[s.Name]=this.activePrompt=s}setAttribute(e,t,s){this.addAttribute(e.toLowerCase(),s).Value=t}addAttribute(e,t){let s=this.attributes[e.toLowerCase()];return s||(this.attributes[e.toLowerCase()]=s=new Se(e.toLowerCase()),s.Line=t,s)}addInference(e,t,s,r){const n=new Re(e);n.Value=t,n.Line=r,s?this.ActiveRule.AltInferences.push(n):this.ActiveCondition.Inferences.push(n),this.addAttribute(e,n.Line)}addPremise(e,t,s,r,n){const i=new je(n);i.Left=t,i.Right=s,i.Comparator=r,i.Keyword=e,i.Line=n,this.ActiveCondition.Premises.push(i),t.forEach((e=>{e&&e.type===m&&this.addAttribute(e.value,n)})),s.forEach((e=>{e&&e.type===m&&this.addAttribute(e.value,n)}))}addCondition(e,t,s,r,n){const i=new Oe;this.ActiveRule.Conditions.push(i),this.addPremise(e,t,s,r,n)}addRule(e,t){const s=new Ve(e);s.Line=t,this.rules.push(s)}addGoal(e,t){const s=new Fe(e.toLowerCase());s.Line=t,this.goals[s.Name]=s}setPromptCFMode(){this.ActivePrompt.CFMode=!0}addObject(e,t){this.objects[e.toLowerCase()]=t}addArray(e,t){this.arrays[e.tolowerCase()]=t}setGoalCF(e,t){this.goals[e.toLowerCase()].CF=t}addNewLine(){}}class ze{constructor(){this.topics={}}on(e,t){this.topics[e]||(this.topics[e]=[]);let s=this.topics[e].push(t)-1,r=this;return{remove:function(){r.topics[e].splice(s,1)}}}trigger(e,t){this.topics[e]&&this.topics[e].forEach((e=>{e(null!=t?t:{})}))}emit(e,t){this.trigger(e,t)}fire(e,t){this.trigger(e,t)}publish(e,t){this.trigger(e,t)}destroy(){Object.keys(this.topics).forEach((e=>{let t=this.topics[e];for(;t.length>0;)t.pop()})),delete this.topics}}const Ye=/[eE][+-]?[0-9]/,Ge="(?:"+("[0-9]+.[0-9]+("+Ye.source+")?")+"|"+(".[0-9]+("+Ye.source+")?")+"|"+("[0-9]+."+Ye.source)+"|"+("[0-9]+"+Ye.source)+")[fFdD]?|[0-9]+[fFDd]"+"|"+("(?:"+/0/.source+"|"+/[1-9][0-9]*/.source+"|"+/0[0-7]+/.source+"|"+/0[xX][0-9a-fA-F]+/.source+")[lL]?"),_e={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQR1_2",SQRT2:"Math.SQRT2"},He={abs:"Math.abs",acos:"Math.acos",acosh:"Math.acosh",asin:"Math.asin",asinh:"Math.asinh",atan:"Math.atan",atanh:"Math.atanh",atan2:"Math.atan2",cbrt:"Math.cbrt",ceil:"Math.ceil",clz32:"Math.clz32",cos:"Math.cos",cosh:"Math.cosh",exp:"Math.exp",expm1:"Math.expm1",floor:"Math.floor",fround:"Math.fround",hypot:"Math.hypot",imul:"Math.imul",log:"Math.log",ln:"Math.ln",log1p:"Math.log1p",log10:"Math.log10",log2:"Math.log2",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sign:"Math.sign",sin:"Math.sin",sinh:"Math.sinh",sqrt:"Math.sqrt",tan:"Math.tan",tanh:"Math.tanh",trunc:"Math.trunc"};class Ke{constructor(e){this.init()}get SpecialCharacters(){return[[B,"("],[z,")"],[Y,"["],[G,"]"],[_,"^"],[H,"*"],[X,"-"],[Q,"+"],[K,"/"],[W,"%"],[$,"="],[Z,">"],[J,"<"],[ee,","],[q,'"'],[b,"\n"],[re,""]]}init(){this.row=0,this.col=0}tokenizeWord(e,t){let s=0,r="",n=t,i=e[t];do{r+=i,s++,n++,i=e[n]}while(i&&i.match(/[^*+-/^(),![\]\s]/i));if(s>0){return[s,new le(m,r,this.row,this.col)]}return[0,null]}tokenizeString(e,t){if('"'===e[t]){let s='"',r=1,n=this.col,i=e[t+r];for(;'"'!==i&&void 0!==i;)s+=i,r++,i=e[t+r];return s+='"',[r+1,new le(q,s,this.row,n)]}if("'"===e[t]){let s="'",r=1,n=this.col,i=e[t+r];for(;"'"!==i&&void 0!==i;)s+=i,r++,i=e[t+r];return s+="'",[r+1,new le(q,s,this.row,n)]}return[0,null]}tokenizeNumber(e,t){var s="";let r=0,n=t,i=null;for(;e[n]&&e[n].toString().match(Ge);)s+=e[n],r++,n++;if(e[n]&&"."==e[n]){for(s+=e[n],r++,n++;e[n]&&e[n].toString().match(Ge);)s+=e[n],r++,n++;i=[r,new le(O,Number(s),this.row,this.col)]}else i=[r,new le(O,Number(s),this.row,this.col)];return r>0?i:[0,null]}skipWhiteSpace(e,t){var s="";let r=0,n=t,i=e[t];do{s+=i,r++,n++,i=e[n]}while(i&&"\n"!==i&&i.match(/\s/));if(r>0){return[r,new le(te,s,this.row,this.col)]}return[0,null]}tokenizeComment(e,t){if("*"===e[t+1]){let s="",r=t,n=e[t],i=0;do{if(s+=n,i++,r++,n=e[r],"\n"===n)this.col=0,this.row++;else if("/"===n&&"*"===s[s.length-1]){s+=n,i++;break}}while(n);return[i,new le(p,s,this.row,this.col)]}return"/"===e[t+1]?this.tokenizeLineComment(e,t):[0,null]}tokenizeLineComment(e,t){let s=e[t],r=0;if("/"===e[t+1]){let n="",i=t;do{n+=s,r++,i++,s=e[i]}while(s&&"\n"!==s);return[r,new le(p,n,this.row,this.col)]}return[0,null]}static flagComment(e){let t=[];for(let s=0;s<e.length;s++){let r=e[s];if(r.type===K){let n=e[s+1];if(n){let i=Object.assign({},r),o=[];if(n.type===K)do{o.push(r.value),s++,r=e[s]}while(r&&r.type!==b);else if(n.type===H)do{if(o.push(r.value),s++,r=e[s],r&&r.type===K&&e[s-1].type===H){o.push(r.value);break}}while(s<e.length);i.value=o.join(""),i.type=p,t.push(i);continue}}t.push(r)}return t}static filterComment(e){return e.filter((e=>e.type!==p&&e.type!==d))}static filterSpace(e){return e.filter((e=>e.type!==te))}static transform(e){let t=[];for(let s=0;s<e.length;s++){let r=e[s];if("EOF"===r.type)break;let n=[];if(r.type===m){let i=r.row,o=r.column;do{n.push(r.value),s++,r=e[s],r.type!==p||(s++,r=e[s])}while(r&&(r.type===m||r.type==O||r.type===te));if(s--,n.length>0){e[s].type===te&&(n.pop(),s--);let r=n.join(" ");t.push({type:m,value:r,row:i,column:o})}}else t.push(r)}return t}tokenize(e){this.row=0,this.col=0;let t=0,s=[],[r,n]=[0,null];for(;t<e.length;){let o=e[t],a=!1,l=this.SpecialCharacters.find((e=>e[1]===o));switch(o){case"\n":s.push(new le(b,o,this.row,this.col)),t++,this.col=0,this.row++;break;default:if("/"!==o||"*"!==e[t+1]&&"/"!==e[t+1])if('"'===o){let[s,i]=this.tokenizeString(e,t);r=s,n=i}else if(l)n=new le(l[0],o,this.row,this.col),r=1;else if(RegExp(Ge).test(o)){let[s,i]=this.tokenizeNumber(e,t);r=s,n=i}else if(RegExp(/\s/).test(o)){let[s,i]=this.skipWhiteSpace(e,t);r=s,n=i}else if(RegExp(/[a-zA-Z]|\w/i).test(o)){let[s,i]=this.tokenizeWord(e,t);r=s,n=i}else a=!1;else{let[s,i]=this.tokenizeComment(e,t);r=s,n=i}if(0!==r&&(a=!0,t+=r,this.col+=r,s.push(n)),!a){var i=new le(se,e[t],this.row,this.col);s.push(i),t++}}}return s.push(new le(re,"",this.row,-1)),s}}class Qe extends ze{constructor(e="en"){super(),this.language=e,this.keywords=ae[e.toLowerCase()],this.keyMap=Object.keys(this.keywords),this.keyValues=Object.values(this.keywords),this.tokens=[],this.prev=null,this.parseToken=function(e){return{rule(){if(null===e.prev||e.prev===F||e.prev===E||e.prev===y||e.prev===N){e.prev=v;const t=e.scanRule();return e.emit("rule",[t,e.row],this),!0}},if(){if(e.prev===v){e.prev=C;const[t,s,r]=e.scanPremise();return e.emit("condition",[C,t,s,e.row,r],this),!0}},or(){if(e.prev===C||e.prev===x||e.prev===M||e.prev===N){e.prev=M;const[t,s,r]=e.scanPremise();return e.emit("premise",[M,t,s,e.row,r],this),!0}},and(){if(e.prev===C||e.prev===x||e.prev===E||e.prev===y||e.prev===N){if(e.prev===E){const[t,s]=e.scanInference();e.emit("inference",[t,s,!1,e.row],this)}else if(e.prev===y){const[t,s]=e.scanInference();e.emit("inference",[t,s,!1,e.row],this)}else{const[t,s,r]=e.scanPremise();e.emit("premise",[N,t,s,e.row,r],this)}return e.prev=N,!0}},then(){if(e.prev===C||e.prev===x||e.prev===M||e.prev===N){e.prev=E;const[t,s]=e.scanInference();return e.emit("inference",[t,s,!1,e.row],this),!0}},elseif(){if(e.prev===E||e.prev===N||e.prev===y){e.prev=C;const[t,s,r]=e.scanPremise();return e.emit("condition",[x,t,s,e.row,r],this),!0}},else(){if(e.prev===E||e.prev===N){e.prev=y;const[t,s]=e.scanInference();return e.emit("inference",[t,s,!0,e.row],this),!0}},prompt(){if(null===e.prev||e.prev===F||e.prev===E||e.prev===y){e.prev=T;const t=e.scanPrompt();return e.emit("prompt",[t,e.row],this),!0}},question(){if(e.prev===T){e.prev=A;const t=e.scanQuestion();return e.emit("question",[t,e.row],this),!0}},menu(){if(e.prev===A){e.prev=F;const t=e.scanMenu();return e.emit("menu",[t,e.row],this),this}},digit(){if(e.prev===A)return e.prev=F,e.scanDigit(),e.emit("digit",[e.row],this),!0},text(){if(e.prev===A)return e.prev=F,e.scanText(),e.emit("text",[e.row],this),!0},yes(){if(e.prev===A)return e.prev=F,e.scanYesNo(),e.emit("yes-no",[e.row],this),!0},true(){if(e.prev===A)return e.prev=F,e.scanTrueFalse(),e.emit("true-false",[e.row],this),!0},min(){if(e.prev===F){const t=e.scanMin();return e.pos--,t&&e.emit("min",[t,e.row],this),!0}},max(){if(e.prev===F){const t=e.scanMax();return e.pos--,t&&e.emit("max",[t,e.row],this),!0}},cf(){if(e.prev===F)return e.emit("cf",[e.row],this),!0},mod(){if(e.prev===F)return e.emit("cf",[e.row],this),!0},attribute(){const t=e.scanAttribute();return e.emit("attribute",[t,e.row],this),!0},goal(){if(null===e.prev||e.prev===F||e.prev===E||e.prev===y){const t=e.scanGoal();return e.emit("goal",[t,e.row],this),!0}},array(){if(null===e.prev||e.prev===F||e.prev===E||e.prev===y){const t=e.scanArray();return e.emit("array",[t,e.row],this),!0}},title(){if(null===e.prev){const t=e.scanTitle();return e.emit("title",[t,e.row],this),!0}},summary(){if(null===e.prev){const t=e.scanSummary();return e.emit("summary",[t,e.row],this),!0}},line(){return e.emit("line",[e.row],this),!0},eof(){return e.emit("eof",[e.row],this),!0},error:()=>(e.error("Unknown character or token: "+token.value,token),!0)}}(this)}get Errors(){return this.errors}get Event(){return super.prototype}init(){this.row=0,this.col=0,this.errors=[],this.attributes={},this.prompts={},this.inferences=[],this.knowledgebase=null,this.data=null}matchCloseParenthesis(e,t){let s=-1,r=0,n=0;for(let i=t;i<e.length;i++){const t=e[i].value;if("("===t?r++:")"===t&&n++,r>0&&r===n){s=i;break}}return s}matchOpenParenthesis(e,t){let s=-1,r=0,n=0;for(let i=t;i>=0;i--){const t=e[i].value;if("("===t?r++:")"===t&&n++,r>0&&r===n){s=i;break}}return s}matchParenthesis(e){if(!e)return;this.matchBrackets(e);const t=[],s=[];for(let r=0;r<e.length;r++){const n=e[r].value;"("===n?t.push([r,n]):")"===n&&s.push([r,n])}for(let s=t.length-1;s>=0;s--){if(-1===this.matchCloseParenthesis(e,t[s][0])){const e="Open parenthesis '{0}' at column {1} has no close parenthesis";this.error(e);break}}for(let t=0;t<s.length;t++){const r=s[t][0];if(-1===this.matchOpenParenthesis(e,r)){const e="Close parenthesis '{0}' at column {1} has no opening parenthesis";this.error(e);break}}}matchCloseBracket(e,t){let s=-1,r=0,n=0;for(let i=t;i<e.length;i++){const t=e[i].value;if("["===t?r++:"]"===t&&n++,r>0&&r===n){s=i;break}}return s}matchOpenBracket(e,t){let s=-1,r=0,n=0;for(let i=t;i>=0;i--){const t=e[i].value;if("["===t?r++:"]"===t&&n++,r>0&&r===n){s=i;break}}return s}matchBrackets(e){if(!e)return;const t=[],s=[];for(let r=0;r<e.length;r++){const n=e[r].value;"["===n?t.push([r,n]):"]"===n&&s.push([r,n])}for(let s=t.length-1;s>=0;s--){if(-1===this.matchCloseBracket(e,t[s][0])){const e="Open bracket '{0}' at column {1} has no close bracket";this.error(e);break}}for(let t=0;t<s.length;t++){const r=s[t][0];if(-1===this.matchOpenBracket(e,r)){const e="Close bracket '{0}' at column {1} has no opening bracket";this.error(e);break}}}matchDuplicateOperator(e){if(e&&e.value.toString().match(/[+\-*/]/)){const t=this.peek();if(t&&t.value.toString().match(/[+\-*/]/))return void this.error("Duplicate operator "+e.value+" "+t.value,e)}}scanRule(){const e=[];let t=null;for(;(t=this.tokens[this.pos])&&t.type!==b&&t.type!==re;)e.push(t.value),this.advance();return`${e.join(" ")}`}scanDefinition(e,t){this.eat(e);const s=[];let r=this.devour();if(!r)return this.error("definition should have texts",r);do{s.push(r.value),this.advance(),r=this.devour()}while(r&&r.type!==b);return 0===s.length?this.error(t+" definition should have texts",r):s.join(" ")}scanTitle(){return this.scanDefinition("TITLE",ae.TITLE)}scanSummary(){return this.scanDefinition("SUMMARY",ae.SUMMARY)}scanQuestion(){return this.scanDefinition(A,ae.QUESTION)}scanAttribute(){this.eat("ATTRIBUTE");const e=this.eat(m);if(!e)return this.error("Attribute definition should have Attribute Name");if(!this.eat($))return this.error("Expected =");const t=this.rightNode();if(t.type===re)return this.error("Expected expression but found end of file",t);if(t.type===b)return this.error("Expected expression but found new line",t);this.matchParenthesis(e),this.matchParenthesis(t);const s=t.map((e=>e.value));return this.assignGlobal(e.value,s.join(" "),t[0].row,t[0].column,!0),[e.value,t]}scanArray(){const e=this.eat(g);if(!e)return this.error("Expected array name");if(!this.eat($))return this.error("Expected =");const t=[];if(!this.eat(B))return this.error("Expected (");for(;this.peek()&&this.peek().type!==b&&this.peek().type!==re;){let e=this.tokens[this.pos];if(!e||e.type!==O&&e.type!==m)return this.error("Expected number or Attribute");if(t.push(e),e=this.eat(ee),!e)return this.error("Expected ,");t.push(e)}const s=t.pop();return s&&s.type!==z?this.error("Expected ) but found new line"):(this.assignGlobal(e.value,e.value,e.row,e.column),[e,t,g])}scanGoal(){this.eat("GOAL");const e=this.eat(m);return e?e.value:this.error("Goal definition should have texts")}scanPrompt(){this.eat(T);const e=this.eat(m);return e?(this.prompts[e.value.toLocaleLowerCase()]=e.value,e.value):this.error("Prompt definition should have texts")}scanMenu(){this.eat(F);const e=[];if(!this.eat(B))return this.error("Expected (");let t;for(;(t=this.tokens[this.pos])&&t.type!==z&&t.type!==b&&t.type!==re;){if(!t||t.type!==O&&t.type!==m&&t.type!==L&&t.type!==I&&t.type!==P&&t.type!==S)return this.error("Expected number or Attribute");if(e.push(t),this.peek().type===z){this.advance();break}this.advance(),this.eat(ee)}return e.map((e=>e.value))}scanYesNo(){let e=this.peek();this.eat(L),e&&e.type===ee&&this.eat(ee),this.eat(I)}scanTrueFalse(){let e=this.peek();this.eat(P),e&&e.type===ee&&this.eat(ee),this.eat(S)}scanDigit(){this.eat("DIGIT")}scanText(){this.eat(R)}scanMin(){this.eat("MIN");return this.eat(O)}scanMax(){this.eat("MAX");return this.eat(O)}scanInference(){this.advance();const e=this.leftAttribute();let t=null,s=this.devour(),r=s;if(!r)return this.error("Expected expression but found end of line");switch(s.type){case $:case Z:case J:case U:case V:case D:case j:if(this.advance(),t=this.rightNode(),r){if(t.type===re)return this.error("Expected expression but found end of file",t);if(t.type===b)return this.error("Expected expression but found new line",t);this.matchParenthesis(t)}break;default:r=null}let n=Object.assign({},e);return t||(n.type=P,n.value=this.keywords.TRUE),[e,t||[n]]}scanPremise(){this.advance();const e=this.leftNode();let t=this.devour();if(!t)return this.error("Expected expression but found end of line");this.matchParenthesis(e);let s=null,r=[];switch(this.devour().type){case $:case Z:case J:case U:case V:case D:case j:if(this.advance(),s=t.type,r=this.rightNode(),this.matchParenthesis(r),t){if(r.type===re)return this.error("Expected expression but found end of file",r);if(r.type===b)return this.error("Expected expression but found new line",r);this.matchParenthesis(r)}break;case N:case M:this.pos--;break;default:t=null}if(0==e.length&&this.error("Expected expression but found end of line"),e.forEach((e=>{e.type===m&&(this.attributes[e.value.toLocaleLowerCase()]||this.assignGlobal(e.value,null,e.row,e.column))})),!r||0===r.length){let e=Object.assign({},{});e.type=P,e.value=this.keywords.TRUE,r=[e]}return[e,r,s||$]}peek(){const e=this.pos+1;return e>this.tokens.length-1?null:this.tokens[e]}trace(){const e=this.pos-1;return e<0?null:this.tokens[e]}devour(){return this.tokens[this.pos]}eat(e){const t=this.tokens[this.pos];return t&&t.type===e?(this.advance(),t):this.error("Expected "+e+" but found "+JSON.stringify(t))}advance(){this.pos+=1}rightNode(){const e=[];let t=this.tokens[this.pos];for(;t&&t.type!==b&&t.type!==re;)switch(t.type){case $:case Z:case J:case U:case V:case D:case j:return this.error("Duplicate comparator "+t.value);case N:case M:return e;default:this.matchDuplicateOperator(t),e.push(t),this.advance(),t=this.tokens[this.pos]}return e}leftNode(){const e=[];let t=this.tokens[this.pos];for(;t&&t.type!==b&&t.type!==re;)switch(t.type===se&&this.error("Error",t),t.type){case $:case Z:case J:case U:case V:case D:case j:return e;case N:case M:return e;default:this.matchDuplicateOperator(t),e.push(t),this.advance(),t=this.tokens[this.pos]}return e}leftAttribute(){const e=this.eat(m);return e?(this.inferences[e.value.toLocaleLowerCase()]=e,e):this.error("Expected attribute")}comparator(){const e=this.tokens[this.pos];switch(e.type){case $:case Z:case J:case U:case V:case D:case j:break;default:this.warn("Expected comparator but found "+e.value+" "+e.row)}return this.advance(),e}assignGlobal(e,t,s,r,n){this.attributes[e.toLocaleLowerCase()]={name:e,value:t,row:s,col:r},n&&(this.inferences[e.toLocaleLowerCase()]=e)}checkVarableDeclarations(){Object.keys(this.attributes).forEach((e=>{const t=this.attributes[e];this.inferences[e]||this.prompts[e]||this.warn("No input prompt for attribute "+e,t)}))}warn(e,t){const s={type:"warning",row:t?t.row:this.row,column:t?t.col:this.col,text:e,raw:""};this.errors.push(s),this.emit("warning",s,this)}error(e,t){const s={type:"error",row:t?t.row:this.row,column:t?t.col:this.col,text:e,raw:t};this.errors.push(s),this.emit("error",s,this)}info(e,t){const s={type:"info",row:t?t.row:this.row,column:t?t.col:this.col,text:e,raw:t};this.errors.push(s),this.emit("info",s,this)}filterKeywords(){let e=[];for(let t=0;t<this.tokens.length;t++){let s=this.tokens[t];if(s.type===m){let t=this.keyMap.find((e=>this.keywords[e].toUpperCase()===s.value.toUpperCase()));if(t){let r=Object.assign({},s);r.type=t,e.push(r);continue}}e.push(s)}this.tokens=e}transform(){let e=[];this.filterKeywords();for(let t=0;t<this.tokens.length;t++){let s=this.tokens[t];if(s.type===re)break;let r=[];if(s.type===m){let n=s.row,i=s.column;do{r.push(s.value),t++,s=this.tokens[t]}while(s&&(s.type===m||s.type==O));let o=r.join(" ");e.push({type:m,value:o,row:n,column:i}),t--}else if(s.type===y&&this.tokens[t+1]&&this.tokens[t+1].type===C){let r=this.tokens[t+1],n=Object.assign({},s);n.type=x,n.value=n.value+" "+r.value,e.push(n),t++}else e.push(s)}this.tokens=e}applyMaths(){let e=[];for(let t=0;t<this.tokens.length;t++){let s=null,r=this.tokens[t];const n=this.tokens[t+1];n&&n.type===B&&r.type===m&&He[r.value]?(s=Object.assign({},r),s.type=ne,e.push(s)):r.type===m&&_e[r.value]?(s=Object.assign({},r),s.type=ie,e.push(s)):e.push(r)}let t=[];for(let s=0;s<e.length;s++){let r=null,n=e[s];const i=e[s+1],o=e[s+2];if(n.type!==m&&n.type!==O&&n.type!==ie||i.type!==B&&i.type!==Y)if(!o||o.type!==m&&o.type!==O&&o.type!==ie||n.type!==m&&n.type!==O&&n.type!==ie||i.type!==_)t.push(n);else{let e=Object.assign({},n);e.type="FUNC",e.value="pow";let r=Object.assign({},n);r.type=B,r.value="(";let i=Object.assign({},n);i.type=z,i.value=")";let a=Object.assign({},n);a.type=ee,a.value=",",t.push(e),t.push(r),t.push(n),t.push(a),t.push(o),t.push(i),s++,s++}else{t.push(n),this.keyMap.find((e=>this.keywords[e].toUpperCase()===n.value.toUpperCase()))||(r=Object.assign({},n),r.type=H,r.value="*",t.push(r))}}this.tokens=t}filterComment(){return this.tokens.filter((e=>e.type!==p&&e.type!==d))}parse(e){this.init(),this.pos=0;let t=new Ke(this.language).tokenize(e);for(this.tokens=t.filter((e=>e.type!==te&&e.type!==p)),this.applyMaths(),this.transform(),this.pos=0;this.pos<this.tokens.length;this.pos++){const e=this.tokens[this.pos];this.row=e.row,this.col=e.column;const t=e.type;if(t===p||t===d)continue;const s=this.parseToken[t.toLowerCase()];try{if(s){s()||this.error("Invalid token or keyword: "+e.value,e)}else this.error("Invalid token or keyword: "+e.value,e)}catch(e){throw console.log(e),e}}return this.checkVarableDeclarations(),this.emit("done",{errors:this.errors,tokens:this.tokens}),this.tokens}}class Xe extends Qe{constructor(e){super(e),this.data={}}get Data(){return this.data}compile(e){let t=new Be(this);return this.parse(e),this.data=t?t.Data:{},this.emit("data",{errors:this.errors,data:this.data}),this.data}}class qe extends c{constructor(e="en"){super(e),this.language=e,this.validator=new u(e)}raiseValidationError(e){return qe.raiseValidationError(e)}parse(e){return new Xe(this.language).compile(e)}compile(e){return this.parse(e)}repeat(e){return e?this.run(e):this.raiseValidationError(a.KnowledgebaseNotFound)}run(e){if(!e)return this.raiseValidationError(a.KnowledgebaseNotFound);let t=new Pe(e).run();return this.process(t)}reply(e,t){if(!e)return this.raiseValidationError(a.KnowledgebaseNotFound);if(!t||0===t.toString().trim().length)return this.raiseValidationError(a.NoInput);let s=new Pe(e).input(t);return this.process(s)}process(e){return e||("Prompt"===e.Label||"CF"===e.Label?{type:"prompt",data:e}:e instanceof Array?{type:"answers",data:e}:e)}validate(e,t){return this.validator.validate(e,t)}choice(e,t){return Ie(e,t,this.language)}static raiseValidationError(e){const t=this.t(e);return new r(t,e)}static raiseSecurityError(e){const s=t(code,language);return new n(s,e)}}class We{constructor(){this.row=0,this.col=0,this.errors=[]}get Data(){return this.data}get Error(){return this.errors}error(e,t,s="error"){const r={type:s,row:t.row||this.row,column:t.col||this.col,text:e,raw:t};this.errors.push(r)}tokenizeNumber(e,t){var s="";let r=0,n=t,i=e[t];do{s+=i,r++,n++,i=e[n]}while(i&&i.toString().match(/[0-9]/));if(r>0){return[r,new le(O,Number(s),this.row,this.col)]}return[0,null]}skipWhiteSpace(e,t){var s="";let r=0,n=t,i=e[t];do{s+=i,r++,n++,i=e[n]}while(i&&"\n"!==i&&i.match(/\s/));if(r>0){return[r,new le(te,s,this.row,this.col)]}return[0,null]}tokenizeWord(e,t){let s=0,r="",n=t,i=e[t];do{r+=i,s++,n++,i=e[n]}while(i&&"\n"!==i&&" "!==i);if(s>0){return[s,new le(m,r,this.row,this.col)]}return[0,null]}tokenizeComment(e,t){if("*"===e[t+1]){let s="",r=t,n=e[t],i=0;do{if(s+=n,i++,r++,n=e[r],"\n"===n)this.col=0,this.row++;else if("/"===n&&"*"===s[s.length-1]){s+=n,i++;break}}while(n);return[i,new le(p,s,this.row,this.col)]}return"/"===e[t+1]?this.tokenizeLineComment(e,t):[0,null]}tokenizeLineComment(e,t){let s=e[t],r=0;if("/"===e[t+1]){let n="",i=t;do{n+=s,r++,i++,s=e[i]}while(s&&"\n"!==s);return[r,new le(p,n,this.row,this.col)]}return[0,null]}tokenize(e){this.row=0,this.col=0;let t=0,s=[];for(;t<e.length;){let n=e[t],[i,o]=[0,null],a=!1;switch(n){case"{":s.push(new le(B,n,this.row,this.col)),t++,this.col++;break;case"}":s.push(new le(z,n,this.row,this.col)),t++,this.col++;break;case"=":case":":s.push(new le($,n,this.row,this.col)),t++,this.col++;break;case"\n":s.push(new le(b,n,this.row,this.col)),t++,this.col=0,this.row++;break;default:if(RegExp(/[0-9]/).test(n)){let[s,r]=this.tokenizeNumber(e,t);i=s,o=r}else if(RegExp(/\s/).test(n)){let[s,r]=this.skipWhiteSpace(e,t);i=s,o=r}else if("/"===n){let[s,r]=this.tokenizeComment(e,t);i=s,o=r}else if(RegExp(/[a-zA-Z]/).test(n)){let s=/[a-zA-Z]/,[r,n]=this.tokenizeWord(e,t,s);i=r,o=n}else a=!1;if(0!==i&&(a=!0,t+=i,this.col+=i,s.push(o)),!a){var r=new le(se,e[t],this.row,this.col);s.push(r),t++}}}return s.push(new le(re,"",this.row,-1)),s}}e.Compiler=Xe,e.CustomErrors=o,e.Keywords=ae,e.Parser=Qe,e.ResParser=class{constructor(){this.errors=[],this.data={}}get Data(){return this.data}get Error(){return this.errors}error(e,t,s="error"){const r={type:s,row:t.row||this.row,column:t.col||this.col,text:e,raw:t};this.errors.push(r)}static filterComment(e){return e.filter((e=>e.type!==p&&e.type!==d))}transform(e){let t=[];for(let s=0;s<e.length;s++){let r=e[s];if("EOF"===r.type)break;let n=[];if(r.type===m){let i=r.row,o=r.column;do{n.push(r.value),s++,r=e[s],r.type!==p||(s++,r=e[s])}while(r&&(r.type===m||r.type==O||r.type===te));if(s--,n.length>0){" "===n[n.length-1]&&(n.pop(),s--);let e=n.join(" ");t.push({type:m,value:e,row:i,column:o})}}else t.push(r)}return t}eatKey(e,t,s,r){let n=[],i=t,o=e[i],a=!1;for(;o&&""!==o.value&&"="!==o.value&&"\n"!==o.value;)o.type!==p?n.push(o):a=!0,i++,o=e[i];if(n.length>0)return o.type!==b&&o.type!==re||a||r("Key not assigned: "+n.map((e=>e.value)).join(""),i,o),this.checkParam(n,t),[n.length-1,n];let l=e.filter((e=>e.row===s)).map((e=>e.value)).join("");return!a&&l&&r("Key not found: "+l,i,e.filter((e=>e.row===s))[1]),[0,null]}eatValue(e,t,s,r){let n=[],i=t,o=e[i];for(;o&&""!==o.value&&"\n"!==o.value;)o.type===$&&r("Duplicate assignment",i,o),o.type!==p&&n.push(o),i++,o=e[i];if(n.length>0)return this.checkParam(n,t),[n.length-1,n];if(o&&(o.type===b||o.type===re)){return r("Value not found: "+e.filter((e=>e.row===s)).map((e=>e.value)).join(""),i,o),[0,null]}return[0,null]}eatLeft(e,t){return e[t].type===B?++t:t}eatRight(e,t){let s=e[t];if(s&&s.type===z)return++t;s||(s=e[t-1]);let r="Closing parentesis expected at row: "+s.row+" col:"+s.col+" in"+e.map((e=>e.value)).join("");return this.error(r,s),t}eatNumber(e,t){let s=e[t];if(s&&s.type===te&&(s=e[++t]),s&&s.value.toString().match(/[0-9]/)){do{s=e[++t]}while(s&&s.value.toString().match(/[0-9]/));return s&&s.type===te&&(s=e[++t]),t}let r="Integer expected at row: "+s.row+" col: "+s.col+" in"+e.map((e=>e.value)).join("");return this.error(r,s),t}checkParam(e,t){for(let s=0;s<e.length;s++){let r=e[s];if(r.type===B)s=this.eatLeft(e,s,t),s=this.eatNumber(e,s,t),s=this.eatRight(e,s,t);else if(r.type===z){let t="Closing parenthesis has no matching opening parenthesis at row: "+r.row+" col: "+r.col+" "+e.map((e=>e.value)).join("");this.error(t,r)}}}parse(e){let t=0;var s=(e,t,s)=>{this.error(e,s)};for(let i=0;i<e.length;i++){let o=e[i],a=o.type,l=o.value;switch(a){case p:case re:case te:break;case b:i++,t++;var[r]=this.eatKey(e,i,t+1,s);i+=r;break;case $:i++;var[n]=this.eatValue(e,i,t+1,s);i+=n;break;default:s("Invalid character or token: "+l,0,o)}}return this.Error}tokenize(e,t){let s=(new We).tokenize(e),r=this.transform(s),n=this.parse(r);return"function"==typeof t&&t(n),r}},e.Rules=qe,e.Translator=c,e.Ux=class extends ze{constructor(e,t={}){if(super(),this.language=t.language||"en",!e)throw"Missing Element ID to attach UX";let s=e instanceof Object?e:document.getElementById(e);if(!s)throw"ID not a valid Node";this.text=t.text||null,this.data=null,this.widgets=[],this.prompt={},this.error=null,this.display=null,this.buttons=null,this.container=null,this.rules=new qe(this.language),this.el=s,this.el.style.overflow="hidden",this.loadConsolePanel(),this.attachListeners(),this.attachCSS()}get Text(){return this.text}set Text(e){this.text.text=e}get URL(){return this.url}set URL(e){this.url=e}run(e){this.data=this.rules.compile(e),localStorage.setItem("engine-kb-data",JSON.stringify(this.data)),this.start()}start(){const e=this.rules.run(this.data);this.process(e)}repeat(){let e=localStorage.getItem("engine-kb-data");this.data=JSON.parse(e),this.start()}reply(e){const t=this.rules.reply(this.data,e);this.process(t)}send(){if(!this.data)return console.info("No language defined in kb",console.trace);let e=null;e="NUMBER"===this.prompt.Type||"TEXT"===this.prompt.Type?this.input.value:this.composeReply(),e&&(this.setMargin(),this.input.value="",this.reply(e))}why(){}stop(){}explain(){}cancel(){this.display.innerHTML=""}print(){let e=this.display.innerHTML,t=window.open("about:blank","self","width=600; height=450;",!0);t.document.writeln(e),t.print(),t.close()}copy(){}process(e){if("Prompt"===e.Label||"CF"===e.Label)return this.processPrompt(e);if(e instanceof Array)return this.processAnswers(e);switch(name){case"ValidationError":return this.processValidationError(e);case"SyntaxError":case"ScriptError":return this.processError(e)}}attachScripts(e,t,s){var r=document.body,n=document.createElement("script");n.type="text/javascript",n.id=t||Math.random().slice(2).toString(36),n.name=s||"script"+n.id,n.append(e),r.appendChild(n)}attachListeners(){this.el.addEventListener("keyup",(e=>{13===e.keyCode&&("radio"===e.target.type||"checkbox"===e.target.type||"text"===e.target.type?this.send():e.target.click()),e.preventDefault(),e.stopPropagation()})),this.toolbar.addEventListener("click",(e=>{switch(e.target.id){case"pr-print":this.print();break;case"pr-copy":this.copy()}e.stopPropagation(),e.preventDefault()})),this.buttons.addEventListener("click",(e=>{switch(e.target.innerText){case"✓":this.send();break;case"?":this.why();break;case"!":this.explain();break;case"×":this.cancel();break;case"‣":this.repeat();break;case"⛔":this.stop();break;default:return}this.input.focus(),e.preventDefault(),e.stopPropagation()}))}attachCSS(){const e=document.head,t=document.createElement("style");t.type="text/css",t.rel="stylesheet";t.append("\n    .pr-copy, \n    .pr-print, \n    .pr-toggle {\n      cursor: pointer;\n      padding: 2px;\n      margin-left: 8px;\n      height: 22px;\n      width: 22px;\n      margin-right: 4px;\n    }\n    .pr-toggle {\n       display: inline-block;\n    }\n    .pr-copy {\n        padding-right: 0px;\n        padding-left: 4px;\n     }\n     .pr-print {\n        padding-left: 4px;\n        padding-right: 4px;\n     }\n    .pr-parent {\n        border: 0;\n        min-width: 240px;\n        padding: 2px;\n        transition: background 1.8s;\n    }\n    .pr-container {\n        position:absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        overflow: hidden;\n        transition: background 1.8s;\n        border: 1px solid #777;\n    }\n    .pr-banner, \n    .pr-toolbar {\n        position: relative\n        display: flex;\n        align-items: center;\n        padding-left: 1rem;\n        letter-spacing: 1.4px;\n        font-size: 14px;\n        align-items: center;\n\n    }\n    .pr-banner {\n        height: 1.8rem;\n        font-weight: 400;\n        margin-bottom:0;\n        padding-top: 2px;\n        font-variant: small-caps;\n    }\n    .pr-toolbar {\n        height: 100%;\n        width: 160px;\n        text-align: right;\n        float: right;\n        border-radius:50px;\n        padding-right: 17px;\n        padding-top: 1px;\n        opacity: 0;\n        display: flex;\n        justify-content: flex-end;\n        align-items: baseline;\n    }\n    .pr-banner:hover > .pr-toolbar {\n        transition: all 0.7s;\n        opacity: 100%;\n    }\n    .pr-display {\n        position: absolute;\n        overflow: auto;\n        padding: 4px;\n        top: 32px;\n        bottom: 32px;\n        left: 0;\n        right: 0;\n        background: #222;\n        border-top: 1px solid #777;\n        border-bottom: 1px solid #777;\n        font-size: 16px;\n        letter-spacing: 1.2px;\n        color: cadetblue;\n        text-shadow: none;\n    }\n    .pr-display ul {list-style-type:none; border-bottom:0px solid #999;}\n    .pr-dispaly ol {border-bottom:0px solid #999; list-style:upper-latin;}\n    .pr-display .pr-margin-bottom {border-bottom: 1px solid cadetblue;margin-bottom:5px; padding:5px}\n    .pr-input-panel {\n        position: absolute;\n        left: 0;\n        right: 0;\n        bottom: 4px;\n        padding-top: 0;\n        padding-left: 7px;\n        height: 32px;\n    }\n    .pr-input-buttons {\n      display:inline-block;\n      font-weight:bold;\n      margin-bottom: 2px;\n    }\n    .pr-text-input-container {\n      padding: 2px 4px;\n      background: #999;\n    }\n    .pr-text-input {\n        width: auto;\n        max-width: 80px;\n        outline: none;\n        margin-right: 4px;\n        margin-bottom: 2px\n        padding-left: 7px;\n        background: transparent;\n        font-size: 14px;\n        height: 16px;\n        /*border-radius: 25px 25px;*/\n    }\n    .pr-link-btn {\n        padding: 4px 4px 4px 4px;\n        text-decoration: none;\n        margin: 1px;\n        border-radius: px 2px 2px;\n    }\n    .pr-char {\n        font-size: 1em;\n        font-weight: bold;\n        color: white;\n    }\n    .pr-margin-bottom {\n       border-bottom: 1px solid #777;\n       padding-top: 6px;\n       margin-bottom: 8px;\n    }\n    .gold {\n        background: orange;\n        transition: background 1.8s;\n    } \n    .gold .pr-container{\n       background: blanchedalmond;\n       transition: background 1.8s;\n    }\n    .gold .pr-char, .gold .pr-banner {\n        color: orange;\n         transition: background 1.8s;\n    }\n    .green {\n        background: yellowgreen;\n         transition: background 1.8s;\n    } \n    .green .pr-container{\n       background: lightseagreen;\n        transition: background 1.8s;\n    }\n    .green .pr-char {\n        /*color: white;*/\n    }\n    .blue {\n        background: lightskyblue;\n         transition: background 1.8s;\n    } \n    .blue .pr-container{\n       background: lightskyblue;\n        transition: background 1.8s;\n    }\n    .blue .pr-char {\n        /*color: black;*/\n    }\n    .brown {\n        background: sandybrown;\n         transition: background 1.8s;\n    } \n    .brown .pr-container{\n       background: rosybrown;\n        transition: background 1.8s;\n    }\n    .brown .pr-char {\n       /* color: black;*/\n    }\n    .dark {\n        background: #333;\n         transition: background 1.8s;\n    } \n    .dark .pr-container{\n       background: #444;\n        transition: background 1.8s;\n    }\n    .dark .pr-char {\n       /*color: black;*/\n    }\n    .dark .pr-copy, .dark .pr-print {\n        background: white;\n         transition: background 1.8s;\n    }\n    .light {\n        background: ccc;\n    } \n    .light .pr-container{\n       background: #eee;\n        transition: background 1.8s;\n    }\n    .light .pr-char {\n       color: lightseagreen;\n        transition: color 1.8s;\n    }\n    .light .pr-banner {\n       color: lightseagreen;\n        transition: color 1.8s;\n    }\n    "),e.appendChild(t)}async loadConsolePanel(){const e=Math.random().toString(36).slice(2).toString(36),t=`display${e}`,s=`text${e}`,r=`btPanel${e}`,n=`container${e}`,i=`tb${e}`,o=`banner${e}`,a=`\n        <div id = '${n}' class ='pr-container'>\n            <div id ='${o}' class ='pr-banner'>\n                <span class="pr-banner-title">Rules Interface</span>\n                <div id ='${i}' class ='pr-toolbar'>\n                    <btn id="pr-toggle" class="pr-toggle">\n                      <svg \n                        height="28px"  \n                        width="28px" \n                        viewBox="0 -107 512 512" \n                        xmlns="http://www.w3.org/2000/svg"\n                      ><path d="m0 149.332031c0 82.347657 67.007812 149.335938 149.332031 149.335938h213.335938c82.324219 0 149.332031-66.988281 149.332031-149.335938 0-82.34375-67.007812-149.332031-149.332031-149.332031h-213.335938c-82.324219 0-149.332031 66.988281-149.332031 149.332031zm0 0" fill="#607d8b"/><path d="m448 149.332031c0 47.128907-38.203125 85.335938-85.332031 85.335938-47.128907 0-85.335938-38.207031-85.335938-85.335938 0-47.128906 38.207031-85.332031 85.335938-85.332031 47.128906 0 85.332031 38.203125 85.332031 85.332031zm0 0" fill="#fafafa"/></svg>\n                    </btn> \n                    <btn id="pr-copy" class="pr-copy">\n                        <img width="22px" height="22px" alt="Copy" src="data:image/svg+xml;base64, PHN2ZyBoZWlnaHQ9IjEwMjQiIHdpZHRoPSI4OTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHBhdGggZD0iTTEyOCA3NjhoMjU2djY0SDEyOHYtNjR6IG0zMjAtMzg0SDEyOHY2NGgzMjB2LTY0eiBtMTI4IDE5MlY0NDhMMzg0IDY0MGwxOTIgMTkyVjcwNGgzMjBWNTc2SDU3NnogbS0yODgtNjRIMTI4djY0aDE2MHYtNjR6TTEyOCA3MDRoMTYwdi02NEgxMjh2NjR6IG01NzYgNjRoNjR2MTI4Yy0xIDE4LTcgMzMtMTkgNDVzLTI3IDE4LTQ1IDE5SDY0Yy0zNSAwLTY0LTI5LTY0LTY0VjE5MmMwLTM1IDI5LTY0IDY0LTY0aDE5MkMyNTYgNTcgMzEzIDAgMzg0IDBzMTI4IDU3IDEyOCAxMjhoMTkyYzM1IDAgNjQgMjkgNjQgNjR2MzIwaC02NFYzMjBINjR2NTc2aDY0MFY3Njh6TTEyOCAyNTZoNTEyYzAtMzUtMjktNjQtNjQtNjRoLTY0Yy0zNSAwLTY0LTI5LTY0LTY0cy0yOS02NC02NC02NC02NCAyOS02NCA2NC0yOSA2NC02NCA2NGgtNjRjLTM1IDAtNjQgMjktNjQgNjR6IiAvPgo8L3N2Zz4K">\n                    </btn> \n                     <btn id="pr-print" class='pr-print'>\n                        <svg width="22px" height="22px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve">\n                            <metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>\n                            <g><g transform="translate(0.000000,511.000000) scale(0.100000,-0.100000)"><path d="M2277.8,4767.1c-130.2-59.8-224.2-149.5-279.7-269l-51.2-106.8V2967.3V1541h-431.3c-239.1,0-499.6-10.7-582.9-21.4c-324.5-47-608.5-256.2-753.7-555.1l-79-160.1V-820.3V-2443l79-160.1c145.2-292.5,424.9-501.7,743-550.9c76.9-12.8,337.3-23.5,582.9-23.5h442v-497.5v-497.5l59.8-117.4c64-128.1,194.3-239.1,320.3-275.4c108.9-29.9,5237.3-29.9,5346.2,0c125.9,36.3,256.2,147.3,320.3,275.4l59.8,117.4v497.5v497.5h444.1c243.4,0,503.9,10.7,580.8,21.4c316,49.1,612.8,273.3,753.7,570.1l68.3,145.2v1622.7V804.4l-68.3,145.2c-140.9,296.8-437.7,521-753.7,570.1c-76.9,10.7-337.3,21.4-580.8,21.4h-444.1v1426.2v1424.1l-51.3,106.8c-55.5,119.6-149.5,209.2-279.7,269c-81.1,38.4-215.6,40.6-2722.2,40.6C2493.4,4807.7,2358.9,4805.6,2277.8,4767.1z M7583.4,4338c42.7-42.7,42.7-70.4,42.7-1419.8V1541H5000H2373.9v1377.1c0,1349.4,0,1377.1,42.7,1419.8c42.7,42.7,70.5,42.7,2583.4,42.7S7540.7,4380.7,7583.4,4338z M9103.6,1067c106.7-32,260.5-166.5,322.4-281.8l47-87.5V-818.2v-1515.9l-47-87.5c-61.9-115.3-215.6-249.8-322.4-281.8c-53.4-17.1-258.4-25.6-567.9-25.6h-482.5v597.8v597.8H5000H1946.8v-597.8v-600l-516.7,6.4c-448.4,6.4-529.5,10.7-595.7,44.8c-100.3,51.3-202.8,151.6-260.5,258.4c-47,87.5-47,89.6-47,1603.4c0,1513.8,0,1515.9,47,1601.3c59.8,113.2,166.5,211.4,284,264.8c96.1,42.7,119.6,44.8,4129.2,44.8C8016.9,1092.7,9039.6,1086.3,9103.6,1067z M7626.1-3017.3c0-1029.1-2.1-1059-42.7-1099.6c-42.7-42.7-70.4-42.7-2583.4-42.7s-2540.7,0-2583.4,42.7c-40.6,40.6-42.7,70.5-42.7,1099.6v1056.9H5000h2626.1V-3017.3z"/><path d="M6964.3-871.6v-213.5H7402h437.7v213.5v213.5H7402h-437.7V-871.6z"/><path d="M2822.2-2515.6v-213.5H5000h2177.8v213.5v213.5H5000H2822.2V-2515.6z"/><path d="M2822.2-3391v-213.5H5000h2177.8v213.5v213.5H5000H2822.2V-3391z"/></g></g>\n                        </svg>\n                    </btn> \n                </div>\n            </div>\n            \n            <div id ='${t}' class ='pr-display'></div>\n            <div id ='${r}' class ='pr-input-panel'>\n            <span class='pr-text-input-container'>\n              <input id ='${s}' class ='pr-text-input' type='text'/>\n            </span> \n            <span class='pr-input-buttons'>\n                <a href='javascript:void(0)' title='Send' class='pr-link-btn'><span class='pr-char'>&check;</span></a>\n                <a href='javascript:void(0)' title='Why ask?' class='pr-link-btn'><span class='pr-char'>&quest;</span></a>\n                <a href='javascript:void(0)' title='Explain' class='pr-link-btn'><span class='pr-char'>&excl;</span></a>\n                <a href='javascript:void(0)' title='Disconnect' class='pr-link-btn'><span class='pr-char'>&times;</span></a>\n                <a href='javascript:void(0)' title='Repeat' class='pr-link-btn'><span class='pr-char' style="font-size:1.5rem">&#8227;</span></a>\n            </span>\n          </div>\n        </div>`;this.el.innerHTML=a,this.el.classList.add("pr-parent"),this.theme="dark",this.display=document.getElementById(t),this.input=document.getElementById(s),this.buttons=document.getElementById(r),this.banner=document.getElementById(o),this.toolbar=document.getElementById(i),this.printBtn=document.getElementById("pr-print"),this.printBtn.addEventListener("mousedown",(e=>{this.print(),e.preventDefault(),e.stopPropagation()})),this.copyBtn=document.getElementById("pr-copy"),this.copyBtn.addEventListener("mousedown",(e=>{this.copy(),e.preventDefault(),e.stopPropagation()})),this.toggleBtn=document.getElementById("pr-toggle"),this.toggleBtn.addEventListener("mousedown",(e=>{this.toggleTheme(),e.preventDefault(),e.stopPropagation()})),this.input.focus(),this.container=document.getElementById(n)}toggleTheme(){this.el.classList.toggle(this.theme)}get theme(){return this._theme}set theme(e){e&&(e=e.toLowerCase()),this.theme!==e?(this.el.classList.add(e),this._theme=e):this.el.classList.remove(this.theme)}stylePanel(e){e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.right="0",e.style.bottom="0",e.style.overflow="auto",e.style.paddingLeft=e.style.paddingRight="5px",e.style.background="inherit"}styleDisplay(e){e.style.position="absolute",e.style.top="4px",e.style.left="0",e.style.right="0",e.style.bottom="48px",e.style.overflow="auto",e.style.paddingLeft=e.style.paddingRight="16px"}styleInput(e){e.style.color="#000",e.style.background="#999",e.style.border="1px solid #333",e.style.marginRight="7px",e.style.borderRadius="15px",e.style.padding="4px 4px 4px 12px"}styleLinks(e){let t=e.getElementsByTagName("a");for(let e=0;e<t.length;e++){let s=t[e];s.style.padding="4px 8px 4px 8px",s.style.textDecoration="none",s.style.color="inherit",s.style.margin="1px",s.style.borderRadius="2px 2px"}let s=e.getElementsByClassName("char");for(let e=0;e<s.length;e++){let s=t[e];s.style.fontSize="2em",s.style.fontWeight="bold"}return e}processPrompt(e){this.prompt=e;let t=Math.floor(99999999999999*Math.random()).toString(36);switch(this.disableInputs(),this.appendToContent('<div ><span id = "'+t+'" contentEditable="true">'+e.Index+". "+e.Question+"</span></div>",!0),e.Type){case"MENU":case"CF":case"YN":case"TF":this.showMenu(e,!1)}this.input.focus()}processValidationError(e){this.input.value="",this.input.focus(),this.appendToContent("<div>"+e+"</div>")}processError(e){this.input.value="",this.input.focus(),this.appendToContent("<div>"+(e[0].text||JSON.stringify(e))+"</div>")}processParserErrorsXXX(e){e?e.forEach((e=>{var t=void 0===e.x?e.column:e.x,s=void 0===e.y?e.row:e.y,r="<br/><i style='color:red;' class='fa fa-times'></i> '"+e.text+"'<br/> <i style='color:blue;' class='fa fa-anchor'></i> <a href='javascript:void()' onclick='selectLine("+s+")'>Line: "+(1*s+1)+" Column: "+(t+1)+"</a> <br/><i class='fa fa-code'></i> <a href ='javascript:void()' onclick='selectLine("+s+")'>"+e.text+"</a>";this.display.innerHTML+=r+"<br/>",this.scrollDown("Error")})):this.appendToContent("<div>System error</div>")}processScriptErrorXXX(e){if(e){var t=e.code,s=e.message,r=e.details.line,n=e.details.index,i=e.details.rIndex,o=e.details.rule;try{var a="<br/><strong>"+t+"<br/>Row:&Tab; <a href='javascript:selectLine("+n+")'>"+n+"</a><br/>Details:&Tab;<strong>"+s+"</strong><br/>Code:&Tab;&Tab;<a href ='javascript:selectLine("+n+")'>"+r+"</a><br/>Rule number:&Tab;<strong>"+i+"</strong><br/>Rule:&Tab;&Tab;<a href ='javascript:selectLine("+n+")'>"+o+"</a><br/><hr/><p><p>";this.display.append(a),window.setTimeout((function(){window.Editor.resize(),window.setTimeout((function(){this.scrollDown("content")}),200)}),200)}catch(e){console.log(e)}}else this.appendToContent("<div>System error</div>")}processAnswers(e){if(this.disableInputs(),0!==e.length){var t=["<div class='conclusion'>"];t.push("<span>Conclusion</span>"),e.forEach((function(e){t.push("<br/>"+e.Name),t.push(": "+e.Value),t.push(" - confidence: "+e.CF+"%")})),t.push("</div>"),this.appendToContent(t.join(" "))}}processInfo(e){var t=Math.random().slice(2).toString(36);if(this.appendToContent("<div><b>"+e.msg+"</b></div>"),e.msg.indexOf("Session expired")>-1||e.msg.indexOf("No session")>-1){var s="<a href='javascript:void (0)'  id='"+t+"' class='active-link opensocket'>Click here to start new session</a>";this.appendToContent("<div><b>"+s+"</b></div>"),document.getElementById(t).onclick((function(){this.open()}))}}addClickListener(e){let t=this.el.getElementsByTagName("ul"),s=t[t.length-1];for(let t=0;t<s.childNodes.length;t++){let r=s.children[t];if(r&&r.children){r.children[0].firstChild.addEventListener("click",e)}}}disableInputs(){let e=this.el.getElementsByTagName("ul"),t=e[e.length-1];if(t){this.widgets.forEach((e=>{e.setAttribute("checked",!0)})),this.widgets=[];for(let e=0;e<t.childNodes.length;e++){let s=t.children[e];if(s&&s.children){s.children[0].firstChild.disabled=!0}}}}composeReply(){let e=this.el.getElementsByTagName("ul"),t=e[e.length-1];if(!t)return null;let s={},r=0;for(let e=0;e<t.childNodes.length;e++){let n=t.children[e];if(n&&n.children){let e=n.children[0].firstChild;r++,e.checked?(s[e.value]=r,this.widgets.push(e)):delete s[e.value]}}return Object.values(s).join(",")}composeMenuWidget(e){let t=Math.floor(9999999999999*Math.random()).toString(36),s=[];s=e.Max>1?this.composeCheckBoxes(e,t):this.composeRadioButtons(e,t);var r="<ul>"+s.join(" ")+"</ul>";this.appendToContent(r,!0)}composeCheckBoxes(e,t){return e.Menu.map((e=>'<li><label><input type = "checkbox" name="'+t+'" value="'+e.Name+'"/><span style="margin-left:7px;">'+e.Name+"</span></label></li>"))}composeRadioButtons(e,t){return e.Menu.map((e=>'<li><label><input type = "radio" name="'+t+'" value="'+e.Name+'"/><span style="margin-left:7px;">'+e.Name+"</span></label></li>"))}showMenu(e,t){if(!t)return this.composeMenuWidget(e);var s="<ol >"+e.Menu.map((e=>"<li>"+e.Name+"</li>")).join(" ")+"</ol>";return this.appendToContent(s,!0),null}appendToContent(e,t=!0){e&&e.classList&&e.classList.add("pr-console-line"),this.display.innerHTML+=e,t&&this.scrollDown("content")}setMargin(){var e=this.display.lastChild;e&&e.classList&&e.classList.add("pr-margin-bottom")}scroll(e){var t=this.display;t.scrollTop="up"===e?0:t.scrollHeight}scrollDown(){var e=this.display,t=e.lastChild;try{t?t.scrollIntoView():e.scrollTop=e.scrollHeight}catch(e){}}scrollUp(){var e=this.display,t=e.firstChild;t?t.scrollIntoView():e.scrollTop=e.scrollHeight}showInputBar(){this.appendToContent(" <div id='input-bar'><input type='text' class='input'/> <a href='javascript:void(0)'onclick='disconnect()' >Disconnect</a>  <a href='javascript:void(0)'onclick='open()' >Restart</a>   <a href='javascript:void(0)' onclick='restartClick()'>Refresh</a> </div></br/>")}showTaskBar(){this.appendToContent("<div id='input-bar'> <a href='javascript:void(0)' onclick='connectClick()'>Restart</a>  <a href='javascript:void(0)' onclick='restartClick()'>Refresh</a> </div>")}},e.Validator=u,e.keys=a}));
//# sourceMappingURL=rules-engine-lib.min.js.map
