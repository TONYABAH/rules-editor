import e,{Range as t,EditSession as n,UndoManager as o}from"ace-builds/src-noconflict/ace.js";import"ace-builds/src-noconflict/theme-cobalt.js";import"ace-builds/src-noconflict/theme-merbivore_soft.js";import"ace-builds/src-noconflict/theme-monokai.js";import"ace-builds/src-noconflict/theme-tomorrow_night_blue.js";import"ace-builds/src-noconflict/theme-twilight.js";import"ace-builds/src-noconflict/theme-solarized_light.js";import"ace-builds/src-noconflict/theme-ambiance.js";import"ace-builds/src-noconflict/theme-chrome.js";import"ace-builds/src-noconflict/theme-textmate.js";import"ace-builds/webpack-resolver";import{Rules as r}from"rules-engine";e.config.set("basePath","ace-builds/src-noconflict/");const s=e.require("ace/mode/text_highlight_rules").TextHighlightRules,i=e.require("ace/mode/text").Mode,a=e.require("ace/mode/folding/fold_mode").FoldMode,l=e.require("ace/token_iterator").TokenIterator,c={light:["Solarized Light","Ambience","Chrome","Textmate"],dark:["Cobalt","Merbivore Soft","Monokai","Tomorrow night blue","Twilight"]};var g={__proto__:null,ace:e,Range:t,EditSession:n,UndoManager:o,BaseFoldMode:a,TokenIterator:l,TextHighlightRules:s,TextMode:i,Themes:c};r.init(["fr","de"]);const u=s;class h extends u{constructor(e){super(),this.keywords={},this.rules=new r(e,"ace/mode/kbf"),this.setLanguage(e)}getRules(){return{start:[{token:"comment",regex:/\/\/.*$/},{token:"comment",regex:/\/\*/,next:"comment"},{token:"string",regex:/'(?:.|\\(:?u[\da-fA-F]+|x[\da-fA-F]+|[tbrf'"n]))?'/},{token:"string",regex:"`",next:"string"},{token:"string",regex:"'",next:"qstring"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:/[+-]?\d+(?:(?:\.\d*)?(?:[eE][+-]?\d+)?)?\b/},{token:"punctuation.operator",regex:/\?|\:|\,|\;|\./},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:/\s+/},{token:"keyword.operator",regex:/[-+%=<>*]|[~:,.&!^]/},{token:"keyword.operator",regex:"abs sign ceil floor trunc frac acos asin atan cos sin tan cosh sinh tanh exp log log10 sqrt pi".split(" ").join("|")},{token:e=>{const t=this.keywordEntries.find(t=>t[1].toLowerCase()===e.toLowerCase());if(!t)return"text";switch(t[0]){case"TRUE":case"FALSE":case"YES":case"NO":return"constant.language.boolean";case"OR":case"AND":case"IF":case"ELSE":case"ELSEIF":case"THEN":return"keyword.control";case"DIGIT":case"TEXT":case"MENU":case"NUMBER":return"constant.language";default:return"keyword.other"}},regex:new RegExp(/\b\w+\b/)},{caseInsensitive:!0}],qstring:[{token:"constant.language.escape",regex:/''/},{token:"string",regex:"'",next:"start"},{defaultToken:"string"}],string:[{token:"constant.language.escape",regex:/``/},{token:"string",regex:"`",next:"start"},{defaultToken:"string"}],comment:[{token:"comment",regex:"\\*\\/",next:"start"},{defaultToken:"comment"}]}}setLanguage(e){if(this.keywords=this.rules.getKeywords(),!this.keywords)throw new Error("Language not supported yet: "+e||"");this.keywordEntries=Object.entries(this.keywords),this.$rules=this.getRules(),this.normalizeRules()}}const{Range:d,BaseFoldMode:m,TokenIterator:f}=g,k={en:{foldingStartMarker:/\b^\s*(?:rule|prompt|summary)\b/i,foldingStopMarker:/\b^\s*(?:prompt|rule|max|min|text|digit|yes\/no)\b/gi,foldingStopMenu:/\b^\s*(?:max|min|text|digit|yes\/no)\b/gi},fr:{foldingStartMarker:/\b^\s*(?:rule|prompt|summary)\b/i,foldingStopMarker:/\b^\s*(?:prompt|rule|max|min|text|digit|yes\/no)\b/gi,foldingStopMenu:/\b^\s*(?:max|min|text|digit|yes\/no)\b/gi}};class p extends m{constructor(){super(),this.foldingStartMarker=k.en.foldingStartMarker,this.foldingStopMarker=k.en.foldingStopMarker,this.foldingStopMenu=k.en.foldingStopMenu,this.getFoldWidgetRange=(e,t,n)=>{const o=e.language;var r=e.getLine(n);if(this.foldingStartMarker=k[o].foldingStartMarker,this.foldingStopMarker=k[o].foldingStopMarker,this.foldingStopMenu=k[o].foldingStopMenu,r.match(this.foldingStartMarker))for(var s={row:n,column:r.length},i=new f(e,s.row,s.column),a=i.getCurrentToken(),l=this.foldingStopMarker;a;){if(a.value.match(l)){const e=i.getCurrentTokenRow();return d.fromPoints(s,{row:a.value.match(this.foldingStopMenu)?e:e-1,column:i.getCurrentTokenColumn()})}a=i.stepForward()}return null}}}function x(e,t,n){var o;return function(){var r=this,s=arguments,i=n&&!o;clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(r,s)},t),i&&e.apply(r,s)}}class w extends i{constructor(e,t=!0){super(),this.lineCommentStart="//",this.blockComment={start:"/*",end:"*/"},this.editor=e,this.language=e.session.language,this.$highlightRules=new h(this.language),this.$id="ace/mode/kbf",this.rules=new r(this.editor.session.language||"en",this.$id),t&&this.watch()}watch(){var e=this;this.foldingRules=new p,this.editor.on("change",x(async function(){const t=e.editor.getValue();try{const n=await e.rules.parse(t);e.editor.session.clearAnnotations(),e.editor.session.setAnnotations(n)}catch(e){console.log(e)}},1e3))}}const{TextHighlightRules:b}=g;var S=new class extends b{constructor(){super(),this.$rules={start:[{token:"comment",regex:/\/\/.*$/},{token:"comment",regex:/\/\*/,next:"comment"},{token:"string",regex:"`",next:"string"},{token:"string",regex:"'",next:"qstring"},{token:"constant.numeric",regex:/0[xX][0-9a-fA-F]+\b/},{token:"constant.numeric",regex:/[+-]?\d+(?:(?:\.\d*)?(?:[eE][+-]?\d+)?)?\b/},{token:"keyword.operator",regex:/\W[-+%=<>*]\W|\*\*|[~:,.&$]|->*?|=>/},{token:"paren.lparen",regex:/[\[(\{]/},{token:"paren.rparen",regex:/[\])\}]/},{token:"keyword",regex:/[^=]+(?:[=:])/},{token:"punctuation.operator",regex:/\?[:,;=\.]/},{caseInsensitive:!0}],qstring:[{token:"constant.language.escape",regex:/''/},{token:"string",regex:"'",next:"start"},{defaultToken:"string"}],string:[{token:"constant.language.escape",regex:/``/},{token:"string",regex:"`",next:"start"},{defaultToken:"string"}],comment:[{token:"comment",regex:/\*\//,next:"start"},{defaultToken:"comment"}]}}};const{Range:T,BaseFoldMode:M,TokenIterator:y}=g;class v extends M{constructor(){super(),this.foldingStartMarker=/^\s*\/\/[^-]+$/,this.foldingStopMarker=/^\s*--/,this.getFoldWidgetRange=(e,t,n)=>{var o=e.getLine(n);if(o.match(this.foldingStartMarker))for(var r={row:n,column:o.length},s=new y(e,r.row,r.column),i=s.getCurrentToken(),a=this.foldingStopMarker;i;){if(i.value.match(a)){const e=s.getCurrentTokenRow();return T.fromPoints(r,{row:e,column:s.getCurrentTokenColumn()})}i=s.stepForward()}return null}}}class E extends i{constructor(e,t=!1){super(),this.$highlightRules=this.HighlightRules=S,this.foldingRules=new v,this.editor=e,this.language=e.session.language,this.$id="ace/mode/res",this.rules=new r(this.editor.session.language||"en",this.$id),t||this.watch()}watch(){var e=this;this.editor.on("change",x(async function(){const t=e.editor.getValue();try{const n=await e.rules.parse(t);e.editor.session.clearAnnotations(),e.editor.session.setAnnotations(n)}catch(e){console.log(e)}},1e3))}}class R{constructor(){return R.instance||(R.instance=this),this.language="en",this.editors=[],this.editor=null,this.defaults={fontSize:18,fontName:"Courier New",theme:"ace/theme/tomorrow_night_blue"},this.theme=this.defaults.theme,this.fontSize=this.defaults.fontSize,this.fontName=this.defaults.fontName,R.instance}setHighlightRule(t,n){const o=n?n.substring(n.indexOf(".")):".kbf";let r=null;if(".kbf"===o)r=new w(t);else if(".res"===o)r=new E(t);else{const o=function(e){var t=e.split(".").pop(),n="ace/mode/";if(!t)return n+"text";switch(t){case"js":return n+"javascript";case"json":return n+"json"}}(n),r=e.require(o).Mode;t.session.setMode(new r)}t.session.setMode(r,()=>{t.session.bgTokenizer.start(0)})}edit(t,r={}){let s=null;if("string"==typeof t?s=document.getElementById(t)||document.querySelector(t):t&&(t.id||t.tagName)&&(s=t),!s)return console.error("Invalid container reference: "+s),null;if("object"!=typeof r)return console.error("Invalid options parameter : "+r),null;let i=null;const a=new n(r.text?r.text:"");return a.language=r.language?r.language:this.language,a.setUndoManager(new o),i=e.edit(s,Object.assign({fontSize:r.fontSize||this.fontSize,fontFamily:r.fontName||this.fontName,theme:r.theme||this.theme,showLineNumbers:!0,readOnly:!1,showGutter:!0,animatedScroll:!0,minLines:5,maxLines:"auto",selectionStyle:"row",highlightActiveLine:!0,showPrintMargin:!0},r)),i.data=r.data||{},i.setSession(a),i.renderer.setScrollMargin(10,10,10,10),i.$blockScrolling=Infinity,i.setOptions({scrollPastEnd:.9,autoScrollEditorIntoView:!0}),i.focus(),this.setHighlightRule(i,r.fileName),this.editors.push(i),this.editor=i,setTimeout(()=>{i.clearSelection()},0),i}reset(){this.FontSize=this.defaults.fontSize,this.FontName=this.defaults.fontName,this.Theme=this.defaults.theme}destroy(){this.editors.forEach(e=>{e.destroy(),e.container.remove()})}get Text(){var e;return(null==(e=this.editor)?void 0:e.getValue())||""}set Text(e){var t;return null==(t=this.editor)?void 0:t.setValue(e)}get ThemeList(){return c}set Theme(e){if(!e)return void console.log("Theme not set");let t=e&&e.toLowerCase();(this.Themes.dark.find(e=>e.toLowerCase()===t.toLocaleLowerCase())||this.Themes.light.find(e=>e.toLowerCase()===t.toLocaleLowerCase()))&&(this.theme="ace/theme/"+t.replace(/\s+/g,"_"),this.editors.forEach(e=>e.setTheme(this.theme)))}get Theme(){return this.theme}get FontName(){return this.fontName}set FontName(e){this.fontName=e}get FontSize(){return this.fontSize}set FontSize(e){this.fontSize=e}get Editors(){return this.editors}get Editor(){return this.editor}set Editor(e){this.editor=e}}const L=new R;export{L as default};
//# sourceMappingURL=rules-editor.js.map
